---
import Layout from '../../../layouts/Layout.astro';
import ProjectPage from '../../../components/ProjectPage';
import { getLangFromUrl } from '../../../i18n/utils';
import { projects } from "../../../data/data.ts";
import galleriesData from "../../../data/galleries.json";

const galleries = galleriesData as Record<string, { original: string; thumbnail: string }[]>;

const { lang, slug } = Astro.params;

if (!lang || !['en', 'es'].includes(lang)) {
  return Astro.redirect('/es/projects');
}

if (!slug) {
  return Astro.redirect('/es/projects');
}

const project = projects.find((p) => p.slug === slug);
if (!project) {
  return Astro.redirect('/es/projects');
}

const galleryImages = galleries[project.slug] || [];
---

<Layout title="Project">
  <ProjectPage 
    client:load 
    lang={lang as 'es' | 'en'} 
    slug={slug} 
    project={project} 
    galleryImages={galleryImages} 
  />
</Layout>
