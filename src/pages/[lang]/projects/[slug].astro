---
import ProjectPage from "../../../components/ProjectPage.tsx";
import { projects } from "../../../data/data.ts";
import Layout from "../../../layouts/Layout.astro";
import galleriesData from "../../../data/galleries.json";
const galleries = galleriesData as Record<string, { original: string; thumbnail: string }[]>;

const { lang, slug } = Astro.params;
if (!lang || !['en', 'es'].includes(lang)) {
  return Astro.redirect('/es/projects');
}
if (lang !== "es" && lang !== "en") {
  return Astro.redirect("/es/projects");
}
const project = projects.find((p) => p.slug === slug);
if (!project) {
  throw new Error("Proyecto no encontrado");
}

// Usa la galer√≠a de galleries.json si existe, si no la imagen principal
let galleryImages = galleries[slug as string] || [{
  original: project.image.src,
  thumbnail: project.image.src
}];
---

<Layout>
    <ProjectPage
        lang={lang as 'es' | 'en'}
        slug={slug as string}
        project={project}
        galleryImages={galleryImages}
        client:load
    />
</Layout>
