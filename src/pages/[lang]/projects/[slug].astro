---
import ProjectPage from "../../../components/ProjectPage.tsx";
import { projects } from "../../../data/data.ts";
import Layout from "../../../layouts/Layout.astro";

const { lang, slug } = Astro.params;
if (!lang || !['en', 'es'].includes(lang)) {
  return Astro.redirect('/es/projects');
}
if (lang !== "es" && lang !== "en") {
  return Astro.redirect("/es/projects");
}
const project = projects.find((p) => p.slug === slug);
if (!project) {
  throw new Error("Proyecto no encontrado");
}

// Usa la galerÃ­a del proyecto si existe, si no la imagen principal
let galleryImages: { original: string; thumbnail: string }[] = [];
if (project.gallery && project.gallery.length > 0) {
  galleryImages = project.gallery.map((img, idx) => ({
    original: typeof img === 'string' ? img : img.src,
    thumbnail: `/assets/projects/${slug}/${slug}-gallery-${idx}-thumb.webp`
  }));
} else {
  galleryImages = [{
    original: project.image.src,
    thumbnail: project.image.src
  }];
}
---

<Layout>
    <ProjectPage
        lang={lang as 'es' | 'en'}
        slug={slug as string}
        project={project}
        galleryImages={galleryImages}
        client:load
    />
</Layout>
